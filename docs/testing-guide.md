# QuoteReview AI 테스트 가이드

## 환경 설정

### 1. 환경 변수 확인

`frontend/.env` 파일에 다음 값들이 설정되어 있는지 확인:

```bash
VITE_SUPABASE_URL=https://your-project.supabase.co
VITE_SUPABASE_ANON_KEY=your-anon-key
VITE_GEMINI_API_KEY=your-gemini-api-key  # AI 검증용 (선택)
NODE_ENV=development
```

### 2. 개발 서버 실행

```bash
cd frontend
npm run dev
```

브라우저에서 http://localhost:5173 접속

### 3. 데이터베이스 확인

```bash
supabase db push  # 마이그레이션 적용 확인
```

## 테스트 시나리오

### 시나리오 1: 사용자 생성 및 로그인

**전제 조건**: Supabase에 테스트 사용자가 없어야 함

1. Supabase 대시보드 → Authentication → Users
2. "Add user" 클릭
3. 입력:
   - Email: `admin@test.com`
   - Password: `Test1234!`
   - Auto Confirm User: ✓ 체크
4. 생성된 사용자 UUID 복사
5. SQL Editor에서 실행:
   ```sql
   INSERT INTO profiles (user_id, email, full_name, role)
   VALUES
     ('복사한-UUID', 'admin@test.com', 'Test Admin', 'admin');
   ```
6. 애플리케이션에서 로그인 테스트
   - Email: `admin@test.com`
   - Password: `Test1234!`

**예상 결과**: 로그인 성공 후 대시보드로 이동

### 시나리오 2: 템플릿 생성

**전제 조건**: 로그인 완료

1. 좌측 메뉴에서 "템플릿 관리" 클릭
2. "템플릿 생성" 버튼 클릭
3. 입력:
   - 템플릿 이름: `표준 견적서 템플릿`
   - 설명: `웹/앱 개발 프로젝트용 표준 견적서`
   - 상태: `활성`
4. "저장" 클릭

**예상 결과**: 템플릿 목록 페이지로 이동, 생성된 템플릿 표시

**확인사항**:
- 템플릿 상태 칩이 "활성"(초록색)으로 표시
- 생성일이 정확히 표시

### 시나리오 3: 견적서 업로드 및 검증 (정상 케이스)

**전제 조건**: 활성 템플릿 1개 이상 존재

#### 3-1. Excel 파일 준비

Excel이나 Google Sheets에서 다음 내용으로 파일 생성 (`quote-valid.xlsx`):

```
견적서

고객명: 테스트 고객
견적번호: Q-2026-001
견적일자: 2026-01-18
유효기한: 2026-02-18
통화: KRW

| 품목          | 수량 | 단가    | 금액     |
|---------------|------|---------|----------|
| 웹사이트 개발 | 1    | 5000000 | 5000000  |
| 모바일 앱 개발| 1    | 3000000 | 3000000  |
| 유지보수      | 12   | 200000  | 2400000  |

소계: 10400000
할인: 400000
세율: 0.1
세액: 1000000
총액: 11000000
```

#### 3-2. 업로드 및 검증

1. 좌측 메뉴에서 "견적서 검증" 클릭
2. 템플릿 선택: `표준 견적서 템플릿`
3. "파일 선택" 클릭, `quote-valid.xlsx` 선택
4. "검증 실행" 클릭
5. 업로드 진행 상태 확인 (LinearProgress)
6. 검증 진행 상태 확인 (약 3-5초)
7. 자동으로 결과 페이지로 이동

**예상 결과**:
- 전체 상태: "통과" (초록색)
- 발견 사항: 0건 또는 매우 적음
- "문제가 발견되지 않았습니다" 메시지

### 시나리오 4: 견적서 업로드 및 검증 (오류 케이스)

#### 4-1. 오류가 있는 Excel 파일 준비 (`quote-with-errors.xlsx`)

```
견적서

고객명: (비워둠)  ← 필수 항목 누락
견적번호: Q-2026-002
견적일자: 2026-02-20
유효기한: 2026-01-20  ← 날짜 논리 오류
통화: USD

| 품목          | 수량 | 단가    | 금액     |
|---------------|------|---------|----------|
| 제품 X        | 10   | 50000   | 600000   | ← 수학 오류
| 제품 Y        | 5    | 100000  | 500000   |

소계: 1100000
할인: 500000  ← 할인율 45% (정책 위반)
세율: 0.1
세액: 60000
총액: 700000  ← 수학 오류

통화: KRW  ← 일관성 오류
```

#### 4-2. 업로드 및 검증

1. "견적서 검증" 페이지에서 파일 업로드
2. 검증 완료 후 결과 페이지 확인

**예상 결과**:
- 전체 상태: "실패" (빨간색) 또는 "경고" (주황색)
- 발견 사항 요약:
  - 치명적: 2-3건 (수학 오류)
  - 높음: 2-3건 (필수 항목, 정책 위반)
  - 보통: 1-2건 (일관성 오류)

**확인사항**:
- 각 발견 사항에 위치, 예상값/실제값, 권장 조치 표시
- 심각도별로 그룹핑되어 표시
- [AI 제안] 태그가 있는 항목 (Gemini API 설정 시)

### 시나리오 5: AI 검증 테스트 (선택)

**전제 조건**: `VITE_GEMINI_API_KEY` 설정

1. 애매한 설명이 포함된 견적서 업로드:
   ```
   | 품목          | 수량 | 단가    | 금액     |
   |---------------|------|---------|----------|
   | 작업          | 1    | 1000000 | 1000000  | ← 모호한 설명
   | 기타 비용     | 1    | 500000  | 500000   | ← 불명확
   ```

2. 검증 결과에서 AI 제안 확인

**예상 결과**:
- [AI 제안] "항목 설명이 구체적이지 않습니다"
- [AI 제안] "전문적이지 않은 표현: '작업', '기타 비용'"

### 시나리오 6: 템플릿 상세 보기 및 수정

1. 템플릿 목록에서 템플릿 행 클릭 또는 눈 아이콘 클릭
2. 상세 페이지에서 정보 확인
3. "수정" 버튼 클릭
4. 설명 수정 후 저장

**예상 결과**: 수정 사항이 목록과 상세 페이지에 반영

## 오류 시나리오 테스트

### 오류 1: 잘못된 파일 형식

1. `.pdf`, `.docx` 등 Excel이 아닌 파일 업로드 시도

**예상 결과**: "Excel 파일만 업로드 가능합니다" 오류 메시지

### 오류 2: 파일 크기 초과

1. 100MB 이상 파일 업로드 시도

**예상 결과**: "파일 크기가 100MB를 초과할 수 없습니다" 오류 메시지

### 오류 3: 템플릿 미선택

1. 파일만 선택하고 템플릿 선택 없이 "검증 실행" 클릭

**예상 결과**: "템플릿을 선택해주세요" 오류 메시지

### 오류 4: 로그아웃 상태 접근

1. 로그아웃
2. `/templates` 또는 `/submissions` URL 직접 접속

**예상 결과**: 로그인 페이지로 자동 리다이렉트

## 데이터베이스 확인

### Supabase 대시보드에서 확인

1. **Templates 테이블**:
   ```sql
   SELECT * FROM templates ORDER BY created_at DESC;
   ```
   - 생성한 템플릿 확인

2. **Submissions 테이블**:
   ```sql
   SELECT * FROM submissions ORDER BY created_at DESC;
   ```
   - status: 'completed'
   - overall_status: 'pass', 'warning', 'fail'

3. **Findings 테이블**:
   ```sql
   SELECT * FROM findings WHERE submission_id = 'submission-uuid';
   ```
   - 발견 사항 확인

4. **Storage 버킷**:
   - Storage → quotes: 업로드된 파일 확인

## 성능 테스트

### 대용량 견적서

1. 100개 라인 항목이 포함된 견적서 생성
2. 업로드 및 검증 시간 측정

**예상 시간**: 5-10초 이내

### 동시 업로드

1. 여러 브라우저 탭에서 동시에 파일 업로드
2. 각 검증이 독립적으로 실행되는지 확인

## 문제 해결

### 개발 서버 오류

```bash
# 의존성 재설치
cd frontend
rm -rf node_modules package-lock.json
npm install

# 캐시 클리어 후 재시작
npm run dev
```

### Supabase 연결 오류

1. `.env` 파일의 URL과 키 확인
2. Supabase 대시보드에서 프로젝트 상태 확인
3. 네트워크 연결 확인

### 파일 업로드 실패

1. Storage 버킷이 생성되었는지 확인:
   ```sql
   SELECT * FROM storage.buckets;
   ```
2. RLS 정책 확인
3. 콘솔에서 상세 오류 메시지 확인

### AI 검증 실패

1. Gemini API 키 유효성 확인
2. 브라우저 콘솔에서 오류 확인
3. Graceful degradation 확인: AI 실패 시에도 결정론적 검증 결과는 표시

## 브라우저 콘솔 로그

정상 작동 시 예상되는 콘솔 로그:

```
[검증 엔진] Layer 1 검증 시작
[검증 엔진] 수학적 검증 완료: 0건 발견
[검증 엔진] 필수 항목 검증 완료: 0건 발견
[검증 엔진] 정책 규칙 검증 완료: 0건 발견
[검증 엔진] 일관성 검증 완료: 0건 발견
[AI 검증] Gemini API 호출 시작
[AI 검증] AI 검증 완료: 0건 발견
[검증 완료] 총 0건 발견, 상태: pass
```

## 다음 단계

모든 테스트가 성공하면:

1. 프로덕션 환경 변수 설정
2. `npm run build` 실행
3. 빌드 결과를 GitHub Pages 또는 다른 호스팅에 배포
