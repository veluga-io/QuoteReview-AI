# 기능 명세서: 클라이언트 견적서 검수 시스템 (MVP)

**Feature Branch**: `001-quote-review`
**Created**: 2026-01-18
**Status**: Draft
**Input**: 사용자 설명: "Client Quote Review System (클라이언트 견적서 검수 시스템) - MVP: 표준 견적서 템플릿 설정 및 자동 검증 기능"

## 배경 및 문제 정의

### 문제

소규모 스타트업 환경에서 클라이언트 대상 견적서는 중요한 재무적, 법적 약속을 나타냅니다. 현재 회사에서 사용하는 표준 견적서 양식이 있지만, 직원이 클라이언트에게 보내기 위해 수정할 때 다음과 같은 문제가 발생합니다:

- **일관성 없는 검증**: 각 직원이 수동으로 확인하며, 필수 항목 누락이나 논리적 오류를 놓칠 수 있음
- **분산된 규칙**: "무엇을 확인해야 하는지"에 대한 규칙이 문서화되지 않고 사람들의 머릿속에만 존재
- **반복적인 실수**: 같은 유형의 오류(잘못된 합계, 필수 조항 누락)가 반복됨
- **검수 병목**: 견적서를 보내기 전에 수동 검토가 필요하여 시간이 소요됨

### 현재 워크플로우

1. 표준 견적서 템플릿 존재 (회사 기준)
2. 직원이 클라이언트별로 견적서 수정
3. 수동으로 확인 (불완전)
4. 클라이언트에게 전송

### 원하는 결과 (MVP 범위)

**자동화된 견적서 검수 시스템**:
1. 관리자가 표준 견적서 템플릿 및 필수 규칙을 시스템에 등록
2. 시스템이 표준 템플릿의 논리적 오류를 자동으로 검증
3. 직원이 수정한 견적서를 업로드하면 자동으로 문제점 발견 및 리포팅

이를 통해:
- 필수 항목 누락 방지
- 수학적 오류(합계, 할인, 세금 계산) 자동 검증
- 표준 템플릿 대비 의도하지 않은 변경 사항 감지
- 검수 시간 단축 및 일관성 확보

## 목표

**주요 목표 (MVP)**:

1. **표준 템플릿 관리**: 회사의 표준 견적서 템플릿을 시스템에 등록하고, 필수 항목 및 검증 규칙을 정의
2. **자동 검증**: 견적서의 수학적 정확성(합계, 할인, 세금), 필수 항목 완전성, 논리적 일관성을 자동으로 검증
3. **차이 분석**: 표준 템플릿 대비 수정된 견적서의 변경 사항을 명확하게 표시
4. **문제 발견 리포팅**: 발견된 문제를 심각도별로 분류하고 구체적인 수정 가이드 제공

**성공 지표 (MVP)**:

- 표준 템플릿 등록 및 검증 규칙 설정 완료
- 견적서 업로드 시 5초 이내에 검증 결과 표시
- 수학적 오류(합계 불일치) 100% 감지
- 필수 항목 누락 100% 감지
- 템플릿 대비 변경 사항 명확하게 표시

## 비목표 (MVP 범위 외)

이 MVP는 다음을 **포함하지 않습니다** (향후 단계에서 구현):

- **승인 워크플로우**: 검토자/승인자 역할, 승인 프로세스, 상태 관리
- **감사 로그**: 변경 이력 추적, 버전 관리, 감사 추적
- **전송 기능**: 견적서 전송, PDF 생성, 이메일 발송
- **사용자 관리**: 다중 역할, 권한 관리, 알림
- **대시보드**: 검토 대기열, 메트릭, 리포팅
- **견적서 생성**: 시스템 내에서 견적서 작성 (기존 파일을 업로드하는 방식)

## 사용자 및 역할 (MVP)

### 페르소나 및 책임

**Admin (관리자)**:
- 표준 견적서 템플릿 등록
- 필수 항목 정의 (어떤 필드가 반드시 있어야 하는지)
- 검증 규칙 설정 (할인 상한, 마진 최소값, 세율 등)
- 표준 템플릿 수정 및 버전 관리

**Staff (직원)**:
- 수정된 견적서 파일 업로드
- 검증 결과 확인 (발견된 문제 목록)
- 문제 수정 및 재검증

### 액세스 제어 요약 (MVP)

| 역할 | 템플릿 관리 | 규칙 설정 | 견적서 업로드 | 검증 실행 | 결과 보기 |
|------|------------|----------|-------------|----------|----------|
| Admin | 생성/수정 | 설정/수정 | 예 | 예 | 예 |
| Staff | 읽기만 | 읽기만 | 예 | 예 | 예 |

## 핵심 엔티티 (MVP)

### Quote Template (표준 견적서 템플릿)

**정의**: 회사가 사용하는 표준 견적서 양식 및 필수 규칙의 정의입니다.

**주요 속성**:
- **템플릿 이름**: 예) "표준 제품 견적서", "서비스 견적서"
- **필수 필드 정의**: 어떤 정보가 반드시 포함되어야 하는지
  - 고객 정보 (회사명, 담당자, 연락처)
  - 견적서 메타데이터 (견적 번호, 발행일, 유효기간, 통화)
  - 라인 항목 (품목/서비스 설명, 수량, 단가)
  - 가격 정보 (소계, 할인, 세율, 세액, 총액)
  - 조건 (결제 조건, 배송 조건, 유효 기간)
  - 면책 조항 및 약관 (필수 법적 문구)
- **검증 규칙**:
  - 수학적 규칙 (라인 합계 = 수량 × 단가, 총액 = 소계 - 할인 + 세금)
  - 정책 규칙 (최대 할인율, 최소 마진율, 유효 세율)
  - 일관성 규칙 (통화 일치, 날짜 논리)
- **기준 템플릿 파일**: 표준 견적서 파일 (Excel, PDF 등)

### Quote Submission (검증 요청)

**정의**: 직원이 업로드한 견적서와 그에 대한 검증 결과입니다.

**주요 속성**:
- **업로드된 파일**: 직원이 수정한 견적서 파일
- **적용된 템플릿**: 어떤 표준 템플릿을 기준으로 검증할지
- **검증 상태**: 검증 중 / 완료 / 오류
- **제출 시간**: 언제 업로드되었는지
- **제출자**: 누가 업로드했는지

### Validation Finding (검증 발견 사항)

**정의**: 견적서 검증 시 발견된 문제점입니다.

**주요 속성**:
- **심각도 수준**:
  - **Blocker**: 치명적 오류 (수학적 오류, 필수 항목 누락)
  - **High**: 정책 위반 (할인율 초과, 마진 부족)
  - **Medium**: 권장 사항 위반 (표준과 다른 문구)
  - **Low**: 정보 제공 (템플릿 대비 변경된 부분)
- **카테고리**:
  - 수학적 오류 (합계 불일치, 계산 오류)
  - 데이터 완전성 (필수 항목 누락, 빈 필드)
  - 정책 위반 (할인 상한 초과, 마진 부족)
  - 일관성 문제 (통화 불일치, 날짜 논리 오류)
  - 템플릿 차이 (표준과 다른 내용)
- **설명**: 무엇이 문제인지 (예: "총액 계산 오류: 입력값 $15,000 ≠ 계산값 $14,850")
- **위치**: 문제가 발견된 위치 (예: "라인 항목 3", "할인 필드", "총액")
- **권장 조치**: 어떻게 수정해야 하는지

### Validation Report (검증 결과 리포트)

**정의**: 견적서 검증의 종합 결과입니다.

**주요 속성**:
- **전체 상태**: Pass (문제 없음) / Warning (주의 필요) / Fail (수정 필요)
- **발견 사항 요약**: 심각도별 문제 개수
- **세부 발견 사항 목록**: 모든 문제점 상세 정보
- **템플릿 차이 요약**: 표준 템플릿 대비 변경된 항목 목록
- **생성 시간**: 검증 실행 시간

## 견적서 검증 워크플로우 (MVP)

### 1단계: 표준 템플릿 설정 (Admin)

```
Admin → 템플릿 업로드 → 필수 항목 정의 → 검증 규칙 설정 → 템플릿 테스트 → 활성화
```

**세부 단계**:
1. 표준 견적서 파일 업로드 (기준이 되는 견적서)
2. 필수 필드 지정 (어떤 정보가 반드시 있어야 하는지)
3. 검증 규칙 설정:
   - 수학적 규칙 (자동 계산 검증)
   - 정책 규칙 (할인 상한, 마진 하한)
   - 필수 문구 (면책 조항, 약관)
4. 테스트: 표준 템플릿 자체를 검증하여 논리적 오류 확인
5. 활성화: 직원이 이 템플릿 기준으로 검증 가능하도록 설정

### 2단계: 견적서 업로드 및 검증 (Staff)

```
Staff → 견적서 업로드 → 템플릿 선택 → 자동 검증 실행 → 결과 확인 → 수정 → 재검증
```

**세부 단계**:
1. 수정된 견적서 파일 업로드
2. 적용할 표준 템플릿 선택
3. 시스템이 자동으로 검증 실행:
   - 파일 파싱 (Excel/PDF → 구조화된 데이터)
   - 필수 항목 확인
   - 수학적 계산 검증
   - 정책 규칙 확인
   - 템플릿 대비 차이 분석
4. 검증 결과 표시:
   - 전체 상태 (Pass/Warning/Fail)
   - 심각도별 문제 목록
   - 각 문제의 위치 및 수정 방법
   - 템플릿 대비 변경 사항
5. 문제 수정 후 재검증 가능

### 상태 흐름

```
Uploaded → Validating → Completed (Pass/Warning/Fail)
```

## 사용자 시나리오 및 테스트 (MVP)

### User Story 1 - 표준 템플릿 등록 및 검증 (Priority: P1)

**여정**: Admin이 회사의 표준 견적서를 템플릿으로 등록하고, 필수 항목 및 검증 규칙을 정의하고, 템플릿 자체가 논리적으로 문제없는지 확인합니다.

**이 우선순위인 이유**: 표준 템플릿이 없으면 검증 기준이 없으므로 시스템의 기초입니다. 템플릿 자체가 논리적으로 정확해야 올바른 검증이 가능합니다.

**독립 테스트**: 표준 견적서 파일을 업로드하고, 필수 항목을 지정하고, 검증 규칙을 설정하고, 템플릿 자체를 검증하여 문제가 없는지 확인함으로써 완전히 테스트할 수 있습니다.

**수락 시나리오**:

1. **Given** 관리자가 로그인되어 있고, **When** 관리자가 "새 템플릿 생성"을 클릭하고 표준 견적서 Excel 파일을 업로드하면, **Then** 시스템은 파일을 파싱하고 감지된 필드 목록(고객명, 견적번호, 라인 항목, 합계 등)을 표시합니다.

2. **Given** 템플릿 파일이 업로드되고, **When** 관리자가 필수 필드를 선택하면 (예: 고객명, 견적번호, 유효기간, 최소 1개 라인 항목, 총액), **Then** 시스템은 선택된 필드를 "필수 항목"으로 표시하고 저장합니다.

3. **Given** 필수 필드가 정의되고, **When** 관리자가 검증 규칙을 설정하면 (예: 최대 할인율 30%, 세율 10%, 라인 합계 = 수량 × 단가), **Then** 시스템은 규칙을 저장하고 규칙 목록을 표시합니다.

4. **Given** 템플릿과 규칙이 설정되고, **When** 관리자가 "템플릿 검증"을 클릭하면, **Then** 시스템은 템플릿 자체에 대해 검증 규칙을 실행하고 결과를 표시합니다 (예: "합계 계산 정확함", "필수 항목 모두 존재").

5. **Given** 템플릿 검증이 통과하고, **When** 관리자가 "템플릿 활성화"를 클릭하면, **Then** 시스템은 템플릿 상태를 "활성"으로 변경하고 직원이 이 템플릿을 선택하여 견적서를 검증할 수 있게 됩니다.

---

### User Story 2 - 견적서 업로드 및 자동 검증 (Priority: P1)

**여정**: Staff가 클라이언트용으로 수정한 견적서를 업로드하고, 표준 템플릿을 선택하고, 자동 검증 결과를 확인합니다.

**이 우선순위인 이유**: 이것이 시스템의 핵심 가치 제공 지점입니다. 직원이 견적서를 검증하여 오류를 발견하고 수정할 수 있어야 합니다.

**독립 테스트**: 의도적으로 문제가 있는 견적서(합계 오류, 필수 항목 누락)를 업로드하고, 검증을 실행하고, 시스템이 문제를 정확히 발견하는지 확인함으로써 테스트할 수 있습니다.

**수락 시나리오**:

1. **Given** 직원이 로그인되어 있고, **When** 직원이 "견적서 검증"을 클릭하고 수정된 견적서 파일을 업로드하면, **Then** 시스템은 파일을 업로드하고 사용 가능한 템플릿 목록을 표시합니다.

2. **Given** 견적서 파일이 업로드되고, **When** 직원이 "표준 제품 견적서" 템플릿을 선택하고 "검증 시작"을 클릭하면, **Then** 시스템은 검증을 시작하고 "검증 중..." 상태를 표시합니다.

3. **Given** 검증이 완료되고, **When** 검증 결과 페이지가 로드되면, **Then** 시스템은 전체 상태(Pass/Warning/Fail), 심각도별 문제 개수(예: Blocker 2개, High 1개, Medium 0개, Low 3개)를 표시합니다.

4. **Given** 검증 결과가 표시되고, **When** 직원이 "Blocker" 탭을 클릭하면, **Then** 시스템은 치명적 오류 목록을 상세히 표시합니다:
   - 문제 1: "총액 계산 오류" | 위치: "총액 필드" | 세부: "입력값 $15,000 ≠ 계산값 (소계 $13,500 - 할인 $0 + 세금 $1,350 = $14,850)" | 조치: "총액을 $14,850으로 수정하십시오"
   - 문제 2: "필수 항목 누락" | 위치: "결제 조건" | 세부: "결제 조건 필드가 비어 있습니다" | 조치: "결제 조건을 입력하십시오 (예: NET30)"

5. **Given** 직원이 문제를 확인하고, **When** 직원이 견적서를 수정하고 다시 업로드하여 재검증하면, **Then** 시스템은 이전에 발견된 문제가 해결되었는지 확인하고 새로운 결과를 표시합니다.

---

### User Story 3 - 템플릿 대비 차이 분석 (Priority: P2)

**여정**: Staff가 견적서 검증 결과에서 표준 템플릿 대비 변경된 항목을 확인하여 의도하지 않은 수정이 없는지 검토합니다.

**이 우선순위인 이유**: 기본 검증(P1)이 작동한 후 추가 가치를 제공합니다. 의도하지 않은 변경(면책 조항 삭제, 약관 변경)을 감지하는 데 중요합니다.

**독립 테스트**: 표준 템플릿의 일부를 의도적으로 변경한 견적서(예: 면책 조항 수정)를 업로드하고, 시스템이 차이를 명확히 표시하는지 확인함으로써 테스트할 수 있습니다.

**수락 시나리오**:

1. **Given** 검증이 완료되고 결과 페이지가 표시되고, **When** 직원이 "템플릿 차이" 탭을 클릭하면, **Then** 시스템은 표준 템플릿 대비 변경된 항목 목록을 표시합니다.

2. **Given** 템플릿 차이 탭이 열리고, **When** 차이 목록이 표시되면, **Then** 시스템은 각 변경 사항을 카테고리별로 그룹화하여 표시합니다:
   - 메타데이터 변경 (예: 유효기간 변경됨)
   - 라인 항목 변경 (예: 라인 항목 3개 추가됨)
   - 가격 변경 (예: 할인율 15% 적용됨)
   - 조건 변경 (예: 결제 조건이 NET60으로 변경됨)
   - 텍스트 변경 (예: 면책 조항 문구 수정됨)

3. **Given** 차이 목록이 표시되고, **When** 직원이 특정 차이 항목(예: "면책 조항 문구 수정됨")을 클릭하면, **Then** 시스템은 이전/이후 비교를 표시합니다:
   - 표준 템플릿: "본 견적서는 30일간 유효하며, 이후 가격 변동이 있을 수 있습니다."
   - 수정된 견적서: "본 견적서는 60일간 유효합니다."
   - 변경 유형: "텍스트 수정"
   - 심각도: "Medium" (표준 문구와 다름)

4. **Given** 직원이 변경 사항을 확인하고, **When** 의도하지 않은 변경(예: 실수로 삭제된 중요 조항)을 발견하면, **Then** 직원은 문제를 수정하고 재검증할 수 있습니다.

---

### User Story 4 - 검증 규칙 수정 및 재검증 (Priority: P3)

**여정**: Admin이 검증 규칙(예: 할인 상한, 세율)을 수정하고, 변경 사항을 저장하고, 기존 견적서를 재검증하여 새 규칙이 적용되는지 확인합니다.

**이 우선순위인 이유**: 정책 변경에 시스템을 적응시키는 데 중요하지만, 초기에는 기본 규칙으로 작동할 수 있습니다. 핵심 검증 기능(P1-P2)이 우선입니다.

**독립 테스트**: 검증 규칙(예: 최대 할인율)을 변경하고, 이전에 검증한 견적서를 재검증하여 새로운 규칙이 적용되고 다른 결과가 나오는지 확인함으로써 테스트할 수 있습니다.

**수락 시나리오**:

1. **Given** 관리자가 로그인되어 있고, **When** 관리자가 "템플릿 관리" → "표준 제품 견적서" → "검증 규칙 편집"을 선택하면, **Then** 시스템은 현재 규칙 목록을 편집 가능한 형태로 표시합니다.

2. **Given** 규칙 편집 화면이 열리고, **When** 관리자가 "최대 할인율" 규칙을 30%에서 25%로 변경하고 "저장"을 클릭하면, **Then** 시스템은 변경 사항을 저장하고 "규칙이 업데이트되었습니다" 메시지를 표시합니다.

3. **Given** 규칙이 변경되고, **When** 직원이 새로운 견적서를 업로드하고 검증하면, **Then** 시스템은 새로운 규칙(최대 할인율 25%)을 적용하여 검증합니다.

4. **Given** 새 규칙이 적용되고, **When** 30% 할인이 적용된 견적서를 검증하면, **Then** 시스템은 "High: 할인율 30%가 정책 최대값 25%를 초과함" 발견 사항을 표시합니다 (이전에는 통과했던 견적서).

---

### 엣지 케이스 (MVP)

**파일 형식 및 파싱 오류**:
- 지원되지 않는 파일 형식이 업로드되면 "지원되지 않는 파일 형식입니다. Excel(.xlsx) 또는 PDF 파일을 업로드하십시오." 오류 표시
- 파일이 손상되었거나 파싱할 수 없으면 "파일을 읽을 수 없습니다. 파일이 손상되었거나 형식이 올바르지 않습니다." 오류 표시

**빈 필드 및 누락 데이터**:
- 필수 필드가 완전히 비어 있으면 "Blocker: 필수 항목 누락" 발견 사항 생성
- 숫자 필드에 숫자가 아닌 값이 있으면 "Blocker: 잘못된 데이터 형식" 발견 사항 생성 (예: 수량 필드에 "TBD")

**반올림 및 부동소수점 오차**:
- 수학적 검증 시 0.01 통화 단위의 허용 오차를 적용 (반올림 차이 허용)
- 예: 계산된 총액이 $14,850.00이고 입력값이 $14,849.99 또는 $14,850.01이면 경고가 아닌 통과

**템플릿 구조 변경**:
- 템플릿의 기본 구조(필수 필드 위치)가 크게 달라진 견적서는 "파일 구조가 템플릿과 크게 다릅니다. 올바른 템플릿을 선택했는지 확인하십시오." 경고 표시

**여러 통화**:
- 템플릿과 견적서의 통화가 다르면 "High: 통화 불일치 - 템플릿은 KRW, 견적서는 USD" 발견 사항 생성
- 환율 계산은 MVP 범위 외 (향후 개선 사항)

**큰 파일 및 성능**:
- 100개 이상의 라인 항목이 있는 견적서도 10초 이내에 검증 완료
- 파일 크기 제한: 10MB (초과 시 "파일이 너무 큽니다. 10MB 이하의 파일을 업로드하십시오." 오류)

**동시 템플릿 업데이트**:
- 검증 중에 템플릿 규칙이 변경되면, 검증은 시작 시점의 규칙 버전을 사용
- 검증 결과에 "적용된 규칙 버전: 2026-01-18 10:30" 표시

## 요구 사항 (MVP)

### 기능 요구 사항

#### Template Management (템플릿 관리)

- **FR-001**: 시스템은 관리자가 표준 견적서 파일을 업로드하여 템플릿으로 등록할 수 있어야 합니다 (지원 형식: Excel .xlsx, PDF).
- **FR-002**: 시스템은 업로드된 파일을 파싱하여 구조화된 데이터(필드 목록, 라인 항목, 합계)를 추출해야 합니다.
- **FR-003**: 시스템은 관리자가 필수 필드를 선택할 수 있도록 허용해야 합니다 (예: 고객명, 견적번호, 유효기간, 라인 항목, 총액은 필수).
- **FR-004**: 시스템은 필드 유형을 정의할 수 있어야 합니다 (텍스트, 숫자, 날짜, 금액, 백분율).
- **FR-005**: 시스템은 관리자가 검증 규칙을 설정할 수 있도록 허용해야 합니다:
  - 수학적 규칙 (예: 라인 합계 = 수량 × 단가, 총액 = 소계 - 할인 + 세금)
  - 정책 규칙 (예: 최대 할인율 30%, 최소 마진율 15%)
  - 필수 텍스트 (예: 특정 면책 조항이 포함되어야 함)
- **FR-006**: 시스템은 템플릿 자체에 대해 검증을 실행하여 논리적 오류를 확인해야 합니다.
- **FR-007**: 시스템은 템플릿 상태를 관리해야 합니다 (Draft / Active / Archived).
- **FR-008**: 시스템은 활성 템플릿만 견적서 검증에 사용할 수 있도록 허용해야 합니다.
- **FR-009**: 시스템은 관리자가 템플릿을 수정하고 새 버전을 생성할 수 있도록 허용해야 합니다.

#### Quote Validation (견적서 검증)

- **FR-010**: 시스템은 직원이 견적서 파일을 업로드할 수 있도록 허용해야 합니다 (지원 형식: Excel .xlsx, PDF).
- **FR-011**: 시스템은 업로드 시 파일 크기 제한(10MB)을 강제해야 합니다.
- **FR-012**: 시스템은 직원이 적용할 표준 템플릿을 선택할 수 있도록 허용해야 합니다 (활성 템플릿 목록 표시).
- **FR-013**: 시스템은 업로드된 견적서 파일을 파싱하여 구조화된 데이터를 추출해야 합니다.
- **FR-014**: 시스템은 견적서에 대해 자동 검증을 실행해야 합니다:
  - 필수 항목 완전성 검증
  - 수학적 정확성 검증
  - 정책 준수 검증
  - 템플릿 대비 차이 분석
- **FR-015**: 시스템은 검증을 5초 이내에 완료해야 합니다 (표준 크기 견적서 기준).
- **FR-016**: 시스템은 검증 중 진행 상태를 표시해야 합니다 ("파일 파싱 중...", "검증 실행 중...", "완료").

#### Validation Results (검증 결과)

- **FR-017**: 시스템은 전체 검증 상태를 결정해야 합니다:
  - **Pass**: Blocker 또는 High 발견 사항 없음
  - **Warning**: High 발견 사항 있음 (진행 가능하지만 주의 필요)
  - **Fail**: Blocker 발견 사항 있음 (수정 필요)
- **FR-018**: 시스템은 심각도별로 발견 사항을 분류해야 합니다:
  - **Blocker**: 치명적 오류 (수학적 오류, 필수 항목 누락)
  - **High**: 정책 위반 (할인율 초과, 마진 부족)
  - **Medium**: 권장 사항 (표준 문구와 다름)
  - **Low**: 정보 제공 (템플릿과 다른 값)
- **FR-019**: 시스템은 각 발견 사항에 대해 다음 정보를 제공해야 합니다:
  - 카테고리 (수학적 오류, 데이터 완전성, 정책 위반, 일관성 문제, 템플릿 차이)
  - 설명 (무엇이 문제인지)
  - 위치 (어디에서 발견되었는지)
  - 세부 정보 (예: 입력값 vs 계산값)
  - 권장 조치 (어떻게 수정해야 하는지)
- **FR-020**: 시스템은 검증 결과를 심각도별로 그룹화하여 표시해야 합니다 (탭 또는 섹션으로 구분).
- **FR-021**: 시스템은 템플릿 대비 차이를 별도 섹션에 표시해야 합니다:
  - 변경된 필드 목록
  - 각 변경에 대한 이전/이후 비교
  - 변경 유형 (추가, 수정, 삭제)

#### Mathematical Validation (수학적 검증)

- **FR-022**: 시스템은 라인 항목 합계를 검증해야 합니다: 라인 합계 = 수량 × 단가 (0.01 허용 오차).
- **FR-023**: 시스템은 소계를 검증해야 합니다: 소계 = 모든 라인 항목 합계의 합 (0.01 허용 오차).
- **FR-024**: 시스템은 할인 적용을 검증해야 합니다:
  - 할인율이 적용된 경우: 할인 금액 = 소계 × 할인율 / 100
  - 고정 할인 금액이 적용된 경우: 할인 금액 검증
- **FR-025**: 시스템은 세금 계산을 검증해야 합니다: 세액 = (소계 - 할인) × 세율 / 100 (0.01 허용 오차).
- **FR-026**: 시스템은 총액을 검증해야 합니다: 총액 = 소계 - 할인 + 세액 (0.01 허용 오차).
- **FR-027**: 시스템은 수학적 불일치를 발견하면 입력값과 계산값을 명확히 표시해야 합니다.

#### Data Completeness Validation (데이터 완전성 검증)

- **FR-028**: 시스템은 템플릿에서 정의된 모든 필수 필드가 존재하고 비어 있지 않은지 확인해야 합니다.
- **FR-029**: 시스템은 데이터 유형을 검증해야 합니다:
  - 숫자 필드에 숫자값이 있는지
  - 날짜 필드에 유효한 날짜가 있는지
  - 금액 필드에 올바른 형식의 금액이 있는지
- **FR-030**: 시스템은 논리적 일관성을 검증해야 합니다:
  - 유효 기간 > 발행일
  - 수량 > 0
  - 단가 > 0
- **FR-031**: 시스템은 최소 하나의 라인 항목이 존재하는지 확인해야 합니다.

#### Policy Validation (정책 검증)

- **FR-032**: 시스템은 할인율이 구성된 최대값을 초과하는지 확인해야 합니다.
- **FR-033**: 시스템은 마진율이 구성된 최소값 이상인지 확인해야 합니다 (원가 정보가 있는 경우).
- **FR-034**: 시스템은 세율이 올바른 범위 내에 있는지 확인해야 합니다.
- **FR-035**: 시스템은 필수 텍스트(면책 조항, 약관)가 포함되어 있는지 확인해야 합니다.
- **FR-036**: 시스템은 통화가 템플릿과 일치하는지 확인해야 합니다.

#### Template Comparison (템플릿 비교)

- **FR-037**: 시스템은 견적서와 표준 템플릿 간의 차이를 식별해야 합니다:
  - 필드 값 변경
  - 라인 항목 추가/제거
  - 텍스트 수정
- **FR-038**: 시스템은 각 차이에 대해 이전/이후 값을 표시해야 합니다.
- **FR-039**: 시스템은 차이를 카테고리별로 그룹화해야 합니다 (메타데이터, 라인 항목, 가격, 조건, 텍스트).
- **FR-040**: 시스템은 중요한 차이(면책 조항 삭제, 약관 변경)를 Medium 또는 High로 플래그해야 합니다.

#### Error Handling (오류 처리)

- **FR-041**: 시스템은 파일 업로드 오류를 처리하고 명확한 오류 메시지를 표시해야 합니다.
- **FR-042**: 시스템은 지원되지 않는 파일 형식을 거부하고 지원되는 형식을 안내해야 합니다.
- **FR-043**: 시스템은 파일 파싱 오류(손상된 파일, 읽을 수 없는 형식)를 처리해야 합니다.
- **FR-044**: 시스템은 파일 크기 초과 시 업로드를 거부하고 제한을 안내해야 합니다.
- **FR-045**: 시스템은 검증 실행 중 오류가 발생하면 부분 결과를 표시하고 오류를 기록해야 합니다.

### 주요 엔티티 (MVP)

- **Quote Template**: 템플릿 이름, 기준 파일, 필드 정의 (이름, 유형, 필수 여부), 검증 규칙, 상태, 버전, 생성/수정 일시
- **Validation Rule**: 규칙 이름, 유형 (수학적/정책/필수 텍스트), 조건, 임계값, 심각도, 오류 메시지
- **Quote Submission**: 제출 ID, 업로드 파일, 적용 템플릿, 제출자, 제출 시간, 검증 상태
- **Validation Report**: 제출 ID, 전체 상태 (Pass/Warning/Fail), 생성 시간, 발견 사항 목록
- **Validation Finding**: 심각도, 카테고리, 설명, 위치, 세부 정보, 권장 조치
- **Template Difference**: 변경 유형 (추가/수정/삭제), 필드 이름, 이전 값, 새 값, 카테고리

## 성공 기준 (MVP)

### 측정 가능한 결과

- **SC-001**: 표준 템플릿 등록 및 필수 항목 정의 완료 (최소 1개의 활성 템플릿).
- **SC-002**: 템플릿 자체 검증을 통과하여 논리적 오류 없음을 확인.
- **SC-003**: 견적서 업로드 후 5초 이내에 검증 결과 표시 (표준 크기 기준).
- **SC-004**: 수학적 오류(합계 불일치, 계산 오류) 100% 감지 (테스트 케이스 기준).
- **SC-005**: 필수 항목 누락 100% 감지 (테스트 케이스 기준).
- **SC-006**: 정책 위반(할인 상한 초과, 마진 부족) 100% 감지 (테스트 케이스 기준).
- **SC-007**: 템플릿 대비 변경 사항 명확하게 표시 (필드 수준 차이).
- **SC-008**: 검증 결과가 실행 가능한 수정 가이드 포함 (각 발견 사항에 권장 조치).
- **SC-009**: 100개 라인 항목이 있는 견적서를 10초 이내에 검증 완료.
- **SC-010**: 사용자(직원)는 검증 도구 사용성 설문조사에서 80% 이상의 만족도 보고.

## 가정 (MVP)

- **Assumption 1**: 표준 견적서 파일은 Excel (.xlsx) 또는 PDF 형식입니다. 다른 형식은 향후 지원 검토.
- **Assumption 2**: 견적서는 일관된 구조를 가지고 있습니다 (템플릿 기반). 완전히 다른 구조의 파일은 지원하지 않음.
- **Assumption 3**: 초기에는 단일 통화(KRW)만 지원. 다중 통화 및 환율 계산은 향후 개선 사항.
- **Assumption 4**: 원가 정보(마진 계산용)는 선택 사항. 제공되면 마진 검증, 없으면 생략.
- **Assumption 5**: 세율은 고정값 또는 수동 입력. 자동 세율 조회는 MVP 범위 외.
- **Assumption 6**: 파일 업로드는 로컬 저장소 또는 클라우드 스토리지 (Supabase Storage) 사용.
- **Assumption 7**: 사용자 인증은 Supabase Auth 사용. Admin과 Staff 역할만 존재.
- **Assumption 8**: 단일 테넌트 (하나의 회사). 다중 테넌트는 향후 고려 사항.

## 미해결 질문 (MVP)

**Q1: 견적서 파일 형식은 무엇입니까?**
- Excel (.xlsx) 우선 지원
- PDF 지원 필요 여부 확인 (PDF 파싱은 복잡도 높음)
- 다른 형식 (CSV, Google Sheets) 필요 여부

**권장 사항**: Excel (.xlsx)로 시작하고 필요시 PDF 지원 추가.

**Q2: 필수 검증 규칙 및 임계값은 무엇입니까?**
- 최대 할인율 (예: 30%?)
- 최소 마진율 (예: 15%?)
- 표준 세율 (예: 10%?)
- 필수 포함 텍스트 (면책 조항, 약관)

**권장 사항**: 비즈니스 팀과 협의하여 초기 규칙 정의.

**Q3: 템플릿 대비 차이 분석 범위는?**
- 모든 필드 비교 vs 중요한 필드만 비교
- 텍스트 변경 감지 방법 (정확히 일치 vs 유사도 비교)
- 라인 항목 순서 변경 감지 필요 여부

**권장 사항**: 중요 필드(메타데이터, 가격, 조건, 면책 조항) 우선 비교. 정확 일치로 시작.

**Q4: 파일 파싱 방법은?**
- Excel: 특정 셀 주소로 필드 매핑 vs 키워드 검색으로 동적 매핑
- 템플릿마다 파싱 규칙을 별도로 정의할 필요가 있는지

**권장 사항**: 특정 셀 주소 매핑으로 시작 (예: B2 = 고객명). 향후 동적 매핑 추가.

**Q5: 검증 결과 저장 여부는?**
- MVP에서 검증 이력을 저장할 필요가 있는지
- 아니면 실시간 검증만 (저장하지 않음)

**권장 사항**: MVP는 실시간 검증만. 이력 저장은 Phase 2 (감사 로그)에서 추가.

## 향후 단계 (MVP 이후)

**Phase 2: 검토 및 승인 워크플로우**
- 검토자/승인자 역할 추가
- 견적서 상태 관리 (Draft → Submitted → Approved)
- 댓글 및 변경 요청 기능
- 승인 정책 (금액 임계값, 2인 승인)

**Phase 3: 감사 로그 및 버전 관리**
- 견적서 변경 이력 추적
- 불변 스냅샷 생성
- 감사 추적 리포팅
- 전송된 견적서 검색 및 조회

**Phase 4: 전송 및 내보내기**
- PDF 생성
- 이메일 통합
- 고객 포털 (견적서 확인)

**Phase 5: 고급 기능**
- 다중 통화 및 환율
- AI 기반 이상 탐지
- 대시보드 및 분석
- 다중 테넌트 지원
